# 🚪🔓 آسیب‌پذیری شماره ۱: کنترل دسترسی شکسته (Broken Access Control)

## 🤔 این چیه به زبان ساده؟

تصور کن یه مهمونی بزرگ گرفتی و به همه مهمون‌ها گفتی فقط توی پذیرایی بمونن. ولی چند نفر یواشکی رفتن تو اتاق خوابت و داشتن توی کمدت نگاه می‌کردن! 😱

همین اتفاق توی وب‌سایت‌ها هم می‌افته. یه نفر ممکنه بتونه به جاهایی که نباید دسترسی داشته باشه، دسترسی پیدا کنه!

## 🎮 مثال بامزه

فرض کن یه بازی آنلاین داریم به اسم "پادشاهی شیرین‌ها" 🍰👑

- **علی** یه بازیکن معمولیه که فقط می‌تونه شیرینی‌های خودش رو ببینه
- **مریم** ادمین بازیه و می‌تونه همه شیرینی‌ها رو ببینه و حذف کنه

حالا علی متوجه میشه که آدرس صفحه شیرینی‌هاش اینجوریه:
```
https://padeshahi-shirin.com/user/123/desserts
```

علی فکر می‌کنه: "اگه شماره ۱۲۳ رو به ۱۲۴ تغییر بدم چی میشه؟" 🤓

```
https://padeshahi-shirin.com/user/124/desserts
```

و بوووم! 💥 علی الان داره شیرینی‌های مریم رو می‌بینه! این یه آسیب‌پذیری کنترل دسترسی شکسته است!

## 🎪 مثال‌های دیگه از دنیای واقعی

### مثال ۱: پنل ادمین سُر خورده 🎭

```
# لینک عادی کاربر
https://myshop.com/profile

# لینک پنل ادمین که کسی نباید بدونه!
https://myshop.com/admin

# ولی اگه کسی تایپ کنه و سایت چک نکنه... اوه اوه! 😬
```

### مثال ۲: تغییر پارامترها 🎲

```
# درخواست معمولی
GET /api/salary?user=ali

# هکر میاد و تغییرش میده به:
GET /api/salary?user=ceo

# و الان داره حقوق مدیرعامل رو می‌بینه! 💰🤑
```

### مثال ۳: دکمه‌های مخفی 🕹️

بعضی سایت‌ها دکمه "حذف" رو توی صفحه مخفی می‌کنن ولی کد اون هنوز توی صفحه هست:

```html
<button id="deleteBtn" style="display:none">حذف همه چی!</button>
```

یه نفر که بلده توی کنسول مرورگر بنویسه:
```javascript
document.getElementById('deleteBtn').click();
```

و تموم! همه چی پاک شد! 🗑️💀

## 🛡️ چطور جلوشو بگیریم؟

### ۱. همیشه توی سرور چک کن! ✅

```javascript
// ❌ بد - فقط توی فرانت‌اند چک می‌کنیم
if (user.isAdmin) {
    showDeleteButton();
}

// ✅ خوب - توی بک‌اند هم چک می‌کنیم
app.delete('/api/user/:id', (req, res) => {
    if (!req.user.isAdmin) {
        return res.status(403).send('نه بابا! تو ادمین نیستی! 🚫');
    }
    // پاک کردن کاربر...
});
```

### ۲. از توکن‌های امن استفاده کن 🎫

به جای این که بگی "کاربر شماره ۱۲۳"، از یه توکن تصادفی استفاده کن:

```
❌ بد: /user/123/orders
✅ خوب: /user/8f4b2c1a-9e3d-4f1b-a8c7-2d5e6f9a1b3c/orders
```

### ۳. دسترسی‌ها رو به صورت پیش‌فرض ببند 🔒

```javascript
// همه چی اول ممنوع، بعد یکی یکی اجازه میدیم
const permissions = {
    viewOwnProfile: ['user', 'admin'],
    viewAllProfiles: ['admin'],
    deleteUsers: ['admin'],
    deleteEverything: ['superadmin']
};
```

## 🎯 چک‌لیست امنیتی

- ✅ هر درخواست رو توی سرور بررسی کن، نه فقط توی مرورگر
- ✅ از ID های قابل حدس زدن استفاده نکن
- ✅ لینک‌های حساس رو مخفی نگه ندار، بلکه محافظتشون کن
- ✅ به طور پیش‌فرض همه چی رو ممنوع کن، بعد مجوز بده
- ✅ تست کن که کاربر عادی نتونه کارای ادمین رو انجام بده

## 🎬 داستان واقعی ترسناک

سال ۲۰۱۹، یه شرکت هواپیمایی یه باگ داشت که با تغییر یه شماره توی URL، می‌تونستی بلیط هواپیمای بقیه رو ببینی و حتی کنسلش کنی!

یه نفر تونست ۹۰۰,۰۰۰ رکورد مسافر رو دانلود کنه! 😱✈️

## 🎓 نکته طلایی

همیشه یادت باشه: **هیچ وقت به کلاینت (مرورگر) اعتماد نکن!**

کاربر می‌تونه:
- کد جاوااسکریپت تو رو تغییر بده
- درخواست‌های HTTP رو دستکاری کنه
- کوکی‌ها رو عوض کنه
- و هزار کار دیگه!

پس همیشه همه چیز رو توی سرور چک کن! 🔐👮

---

## 📚 می‌خوای بیشتر یاد بگیری؟

- [OWASP Access Control Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Access_Control_Cheat_Sheet.html)
- تمرین کن روی: [DVWA (Damn Vulnerable Web Application)](http://www.dvwa.co.uk/)

---

**یادت باشه: امنیت یعنی شک کردن به همه چی و همه کس! (به جز مامان‌بزرگ، اون قابل اعتماده 👵💖)**
